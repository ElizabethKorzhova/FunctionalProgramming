(define (exponent x e) ; Визначаємо функцію експоненти, яка приймає х - степінь експоненти, та е - точність
    (define (exponent-times acc previous current k) ; визначаємо допоміжну функцію для хвостової рекурсії. acc - аккумулятор. previous - попередній елемент. current - поточний елемент. k - індекс елементу
        (if (and (< (abs (- previous current)) e) (< current 1)) ; якщо різниця миж поточним та попереднім елементом менша за епсілон, та поточний елемент менший за одиницю (потрібно, тому що 2 підряд елементи ряду можуть бути однаковими, як наприклад у х = 2)
            (+ acc current) ; повертаємо попередню суму + поточний елемент
            (exponent-times ; інакше викликаємо рекурсивно функцію, передавши в неї нові значення
                (+ acc current) ; новий акумулятор - це сума попереднього акумулятору та поточного елементу
                current ; поточний елемент стає попереднім
                (/ (* x current) k) ; новий елемент домножається на х та ділиться на свій номер
                (+ k 1) ; номер наступного елементу
            )
        )
    )
    (exact->inexact (exponent-times 0 0 1 1)) ; викликаємо допоміжну функцію з початковими значеннями, та приводи дріб до числа з плаваючою крапкою
)

(define (function x e) ; визначаємо функцію згідно з варіантом (12)
    (if (and (<= -2 x) (<= x 0)) ; якщо -2 <= x <= 0
        (+ (exponent x e) (exponent (* 2 x) e)) ; e^x + e^(2x)
        (if (and (< 0 x) (< x 2)) ; інакше, якщо 0 < x < 2
            (- (exponent (+ x 5) e) (exponent (/ x 2) e)) ; e^(x + 5) - e^(x / 2)
            "Incorrect value of x") ; інакше, вивід в консоль, що х задан неправильно, тому що виходить за дозволені межі
    )
)

(define (main-function start step stop) ; визначаємо головну функцію
    (if (< start stop) ; поки start < stop
        (begin
            (display start) ; виводимо поточне значення х
            (display ": ") ; виводимо розділяючу двокрапку між х та е^x
            (display (function start 0.00000001)) ; виводимо е^x
            (newline) ; переходимо на нову лінію
            (main-function (+ start step) step stop) ; рекурсивно викликаємо функцію з новим значенням start
        )
    )
)

(main-function -2 0.5 2) ; викликаємо головку функцію
(display "Похибка: ") ; виводимо повідомлення, що зараз буде виведена похибка
(display (abs (- (exp 0.5) (exponent 0.5 0.00000001)))) ; виводимо похибку
